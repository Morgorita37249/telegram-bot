package crv;

import java.util.Map;
import java.util.HashMap;
import java.util.List;
import java.util.ArrayList;

// Класс - хранилище карты ориентиров
public class Graph {
    public class WayPoint {
        public String name;
        public String ID;
        public List<WayPoint> edges=new ArrayList<WayPoint>();
        public WayPoint(String name, String ID) {
            this.name=name;
            this.ID=ID;
            Graph.registerWayPoint(this);
        }
        public void connect(WayPoint otherWayPoint) {
            if (this == otherWayPoint) return;
            if(!edges.contains(otherWayPoint)) edges.add(otherWayPoint);
        }
    }

    private final Map<String,WayPoint> WayPoints = new HashMap<>();

    public WayPoint getWayPointByID(String id) {
        return WayPoints.get(id);
    }

    public void connectWayPoints(String id1, String id2) {
        WayPoint wp1=WayPoints.get(id1);
        WayPoint wp2=WayPoints.get(id2);
        wp1.connect(wp2);
        wp2.connect(wp1);
    }

    // инициализация из файла на диске, написать позже
    private void readMap() {
        try {
            throw new Exception("not implemented");
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    // конструктор Singleton
    private static Graph instance = new Graph();
    public static Graph getInstance()  {return instance;};

    // Упрощающая процедура для регистрации новосозданных ориентиров
    public static void registerWayPoint(WayPoint wp) {instance.WayPoints.put(wp.ID,wp);};

    // для использования в интерфейсе администратора для заполнения графа посредством команд
    public void newWaypoint(String name) {
        new WayPoint(name,"id"+name);
    }


    public WayPoint getWayPointByName(String message) {
        //Ищем в массиве ориентиров ориентир с похожим именем
        // В сообщении может быть опечатка, пробелы, регистры.
        // Здесь должна быть обработка, чтобы перед поиском оставить только нужный кусок.
        // Либо искать, пробегая по массиву - если в сообщении встречается текст наименования, то возвращать его.
        // НО тогда возможно, что найдётся более одного ориентира.
        return null;
    }

    // В диспетчере бота по команде /nav2 определяем 2 точки между которыми надо проложить путь
    // Возвращаем строку вида "Точка 1 (вы здесь)" -> "Точка 2" -> .... -> "Точка N (вам сюда)"
    // Входные параметры
    //    from: ID исходной точки
    //	  to:	ID целевой точки
    // Обязанность выяснить ID обоих точек возлагаем на диспетчер

    public String getWay(WayPoint from, WayPoint to) {
        //Используем алгоритм поиска в ширину
        return "Да хз";
    }


    private Graph() {
        //readMap();

        //Дубовое заполнение графа кодом
        new WayPoint("501","id501");
        new WayPoint("502","id502");
        new WayPoint("503","id503");
        connectWayPoints("id501","id502");
        connectWayPoints("id502","id503");
    }
}



